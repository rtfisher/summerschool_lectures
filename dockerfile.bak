# Use an appropriate base image
FROM ubuntu:20.04

# Install dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    gfortran \
    openmpi-bin \
    libhdf5-openmpi-dev \
    cmake \
    wget \
    python3 \
    python3-pip \
    git \
    && rm -rf /var/lib/apt/lists/*

# Set environment variables for OpenMPI
ENV PATH /usr/lib/openmpi/bin:$PATH
ENV LD_LIBRARY_PATH /usr/lib/openmpi/lib:$LD_LIBRARY_PATH

# Clone the Flash-X repository from GitHub
WORKDIR /usr/src
RUN git clone https://github.com/rtfisher/Flash-X.git flashx

# Set the working directory to the cloned repository
WORKDIR /usr/src/flashx

# Run the custom setup script
RUN ./setup Sedov -2d -auto

# Change to the object directory and run make
WORKDIR /usr/src/flashx/object
RUN make

# Set the entrypoint to your application
ENTRYPOINT ["mpirun", "-np", "4", "/usr/src/flashx/object/flashx"]

